<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªå®šç¾©åœ–æ–‡æ’ä»¶</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style id="custom-theme">
        /* é€™äº›è®Šæ•¸æœƒè¢« JS å‹•æ…‹ä¿®æ”¹ */
        :root {
            --bg-color: #fdfaf5;
            --accent-color: #d4a373;
            --card-bg: #ffffff;
            --text-color: #4a4a4a;
        }
    </style>
    <style>
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Noto Sans TC', sans-serif;
            transition: background 0.3s;
            margin: 0; padding: 40px;
            display: flex; flex-direction: column; align-items: center;
        }

        /* é ‚éƒ¨æ§åˆ¶é¢æ¿å„ªåŒ– */
        .admin-panel {
            background: white;
            padding: 15px 25px;
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex; gap: 15px; align-items: center;
            margin-bottom: 40px; position: sticky; top: 20px; z-index: 1000;
            flex-wrap: wrap; justify-content: center;
        }

        .color-group { display: flex; align-items: center; gap: 8px; font-size: 12px; font-weight: bold; }
        input[type="color"] { border: none; width: 25px; height: 25px; cursor: pointer; background: none; }

        button {
            padding: 8px 18px; border-radius: 20px; border: none;
            cursor: pointer; font-weight: 600; transition: 0.3s; font-size: 13px;
        }
        .btn-main { background: var(--accent-color); color: white; }
        .btn-dark { background: #333; color: white; }

        /* ç•«å»Šæ¨£å¼ */
        .gallery {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px; width: 100%; max-width: 1100px;
        }

        .card-container { height: 420px; perspective: 1000px; }
        .card-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d; border-radius: 20px;
        }

        .card-container:not(.editing):hover .card-inner { transform: rotateY(180deg); }
        .editing .card-inner { transform: rotateY(180deg); }

        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08); background: var(--card-bg);
            overflow: hidden;
        }
        .card-front img { width: 100%; height: 100%; object-fit: cover; }
        .card-back { transform: rotateY(180deg); display: flex; flex-direction: column; padding: 20px; }

        .title { font-family: 'Playfair Display', serif; font-size: 22px; color: var(--accent-color); margin-bottom: 10px; outline: none; }
        .scroll-content { flex-grow: 1; overflow-y: auto; font-size: 14px; line-height: 1.7; padding-right: 5px; outline: none; }
        
        /* ç·¨è¼¯ UI */
        .edit-tools { margin-top: 10px; display: none; border-top: 1px dashed var(--accent-color); padding-top: 10px; }
        .editing .edit-tools { display: block; }
        .scroll-content::-webkit-scrollbar { width: 3px; }
        .scroll-content::-webkit-scrollbar-thumb { background: var(--accent-color); }
    </style>
</head>
<body>

    <div class="admin-panel">
        <div class="color-group">åº•è‰²<input type="color" id="color-bg" onchange="updateTheme()"></div>
        <div class="color-group">å¡ç‰‡<input type="color" id="color-card" onchange="updateTheme()"></div>
        <div class="color-group">å¼·èª¿<input type="color" id="color-accent" onchange="updateTheme()"></div>
        <div class="color-group">æ–‡å­—<input type="color" id="color-text" onchange="updateTheme()"></div>
        <div style="border-left: 1px solid #ddd; height: 20px; margin: 0 10px;"></div>
        <button class="btn-main" onclick="toggleEdit()" id="edit-btn">âœï¸ ç·¨è¼¯æ¨¡å¼</button>
        <button onclick="addCard()">ï¼‹ æ–°å¢</button>
        <button class="btn-dark" onclick="generateShortLink()">ğŸ”— ç”Ÿæˆåˆ†äº«é€£çµ</button>
    </div>

    <div class="gallery" id="gallery"></div>

    <script>
        let isEditing = false;
        let siteData = {
            theme: { bg: "#fdfaf5", card: "#ffffff", accent: "#d4a373", text: "#4a4a4a" },
            cards: [{ title: "æˆ‘çš„æ•…äº‹", img: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=", text: "é»æ“Šç·¨è¼¯ä¾†ä¿®æ”¹é¡è‰²ã€æ–‡å­—èˆ‡åœ–ç‰‡ã€‚" }]
        };

        function init() {
            const hash = window.location.hash.substring(1);
            if (hash.startsWith('data=')) {
                try {
                    siteData = JSON.parse(decodeURIComponent(escape(atob(hash.replace('data=', '')))));
                } catch(e) { console.error(e); }
            } else {
                const local = localStorage.getItem('myCustomGalleryV4');
                if (local) siteData = JSON.parse(local);
            }
            // åŒæ­¥é¡è‰²é¸æ“‡å™¨
            document.getElementById('color-bg').value = siteData.theme.bg;
            document.getElementById('color-card').value = siteData.theme.card;
            document.getElementById('color-accent').value = siteData.theme.accent;
            document.getElementById('color-text').value = siteData.theme.text;
            updateTheme();
            render();
        }

        function updateTheme() {
            siteData.theme = {
                bg: document.getElementById('color-bg').value,
                card: document.getElementById('color-card').value,
                accent: document.getElementById('color-accent').value,
                text: document.getElementById('color-text').value
            };
            document.documentElement.style.setProperty('--bg-color', siteData.theme.bg);
            document.documentElement.style.setProperty('--card-bg', siteData.theme.card);
            document.documentElement.style.setProperty('--accent-color', siteData.theme.accent);
            document.documentElement.style.setProperty('--text-color', siteData.theme.text);
        }

        function render() {
            const g = document.getElementById('gallery');
            g.innerHTML = '';
            siteData.cards.forEach((c, i) => {
                g.innerHTML += `
                    <div class="card-container ${isEditing ? 'editing' : ''}">
                        <div class="card-inner">
                            <div class="card-front"><img src="${c.img}" id="p-${i}"></div>
                            <div class="card-back">
                                <div class="title" contenteditable="${isEditing}" oninput="siteData.cards[${i}].title=this.innerText">${c.title}</div>
                                <div class="scroll-content" contenteditable="${isEditing}" oninput="siteData.cards[${i}].text=this.innerText">${c.text}</div>
                                <div class="edit-tools">
                                    <input type="file" accept="image/*" onchange="upload(${i}, event)" style="font-size:10px; width:100%">
                                    <button onclick="siteData.cards.splice(${i},1);render()" style="background:#ff7675; color:white; margin-top:5px; padding:2px 10px;">åˆªé™¤</button>
                                </div>
                            </div>
                        </div>
                    </div>`;
            });
        }

        function upload(i, e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (ev) => {
                siteData.cards[i].img = ev.target.result;
                document.getElementById(`p-${i}`).src = ev.target.result;
            };
            reader.readAsDataURL(file);
        }

        function toggleEdit() {
            isEditing = !isEditing;
            document.getElementById('edit-btn').innerText = isEditing ? "âœ… å®Œæˆ" : "âœï¸ ç·¨è¼¯æ¨¡å¼";
            if (!isEditing) localStorage.setItem('myCustomGalleryV4', JSON.stringify(siteData));
            render();
        }

        function addCard() {
            siteData.cards.push({ title: "æ–°å¡ç‰‡", img: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=", text: "ç·¨è¼¯å…§å®¹..." });
            render();
        }

        async function generateShortLink() {
            const base64Data = btoa(unescape(encodeURIComponent(JSON.stringify(siteData))));
            const longUrl = window.location.origin + window.location.pathname + "#data=" + base64Data;
            
            // è¤‡è£½é•·ç¶²å€åˆ°å‰ªè²¼ç°¿ï¼ˆä½œç‚ºå‚™æ¡ˆï¼‰
            await navigator.clipboard.writeText(longUrl);

            // æç¤ºç¸®ç¶²å€
            const confirmShorten = confirm("ç”±æ–¼åœ–ç‰‡è³‡æ–™é‡å¤§ï¼Œç¶²å€éå¸¸é•·ï¼ˆå·²ç‚ºæ‚¨è¤‡è£½ï¼‰ã€‚\n\né»æ“Šã€ç¢ºå®šã€å°‡é–‹å•Ÿ Lihi ç¸®ç¶²å€å·¥å…·ï¼Œè«‹å°‡å‰›æ‰è¤‡è£½çš„ç¶²å€è²¼å…¥å³å¯ç²å¾—çŸ­é€£çµã€‚");
            if (confirmShorten) {
                window.open("https://lihi.io/", "_blank");
            }
        }

        init();
    </script>
</body>
</html>